---
title: Solución de evaluación de vulnerabilidades integrada en Defender for Cloud para Azure y máquinas híbridas
description: Instale una solución de evaluación de vulnerabilidades en máquinas de Azure para obtener recomendaciones de Microsoft Defender for Cloud que le ayuden a proteger Azure y las máquinas híbridas
services: security-center
author: memildin
manager: rkarlin
ms.service: security-center
ms.topic: how-to
ms.date: 10/08/2021
ms.author: memildin
ms.custom: ignite-fall-2021
ms.openlocfilehash: 24c0c2c7454378619926c163ae866f3c2fbd1f23
ms.sourcegitcommit: 106f5c9fa5c6d3498dd1cfe63181a7ed4125ae6d
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/02/2021
ms.locfileid: "131014887"
---
# <a name="defender-for-clouds-integrated-qualys-vulnerability-scanner-for-azure-and-hybrid-machines"></a>Detector de vulnerabilidades de Qualys integrado en Defender for Cloud para Azure y máquinas híbridas

[!INCLUDE [Banner for top of topics](./includes/banner.md)]

Un componente fundamental de cada programa de seguridad y riesgo cibernético es la identificación y el análisis de las vulnerabilidades. 

Defender for Cloud comprueba regularmente las máquinas conectadas para asegurarse de que están ejecutando herramientas de evaluación de vulnerabilidades.

Cuando se detecta una máquina que no tiene implementada una solución de evaluación de vulnerabilidades, Defender for Cloud genera la siguiente recomendación de seguridad:

**Debe habilitarse una solución de evaluación de vulnerabilidades en sus máquinas virtuales**

Use esta recomendación para implementar la solución de evaluación de vulnerabilidades en las máquinas virtuales de Azure y en las máquinas híbridas habilitadas para Azure Arc.

Implemente la solución de evaluación de vulnerabilidades que mejor se adapte a sus necesidades y presupuesto:

- **Herramientas de administración de amenazas y vulnerabilidades de Microsoft Defender para punto de conexión**: detecte vulnerabilidades y configuraciones incorrectas en tiempo real con sensores y sin necesidad de agentes ni exámenes periódicos. Esta capacidad prioriza las vulnerabilidades en función del panorama de amenazas, las detecciones en la organización, la información confidencial de los dispositivos vulnerables y el contexto empresarial. Obtenga más información en [Investigación de puntos débiles con la solución de administración de amenazas y vulnerabilidades de Microsoft Defender para punto de conexión](deploy-vulnerability-assessment-tvm.md).

- **Solución de evaluación de vulnerabilidades integrada (con tecnología de Qualys)** : Defender for Cloud incluye el examen de vulnerabilidades de las máquinas sin costo adicional. No necesita ninguna licencia ni cuenta de Qualys, ya que todo se administra sin problemas en Defender for Cloud. En esta página se proporcionan detalles de este detector e instrucciones para implementarlo.

    > [!TIP]
    > La solución de evaluación de vulnerabilidades integrada de admite tanto máquinas virtuales de Azure como máquinas híbridas. Para implementar el analizador de evaluación de vulnerabilidades en máquinas locales y en varias nubes, conéctelas primero a Azure con Azure Arc, tal como se describe en [Conexión de máquinas que no son de Azure a Defender for Cloud](quickstart-onboard-machines.md).
    >
    > La solución de evaluación de vulnerabilidades integrada de Defender for Cloud funciona sin problemas con Azure Arc. Cuando haya implementado Azure Arc, las máquinas aparecerán en Defender for Cloud y no se requiere ningún agente de Log Analytics.

- **Soluciones Traiga su propia licencia (BYOL)** : Defender for Cloud admite la integración de herramientas de otros proveedores, pero deberá controlar los costos de las licencias, la implementación y la configuración. Al implementar su herramienta con Defender for Cloud, obtendrá información sobre a qué máquinas virtuales de Azure les falta la herramienta. También podrá ver los resultados en Defender for Cloud. Si prefiere usar la licencia de Qualys o Rapid7 privada de la organización en lugar de la licencia de Qualys incluida en Defender for Cloud, consulte [Implementación de una solución de BYOL](deploy-vulnerability-assessment-byol-vm.md).


## <a name="availability"></a>Disponibilidad

|Aspecto|Detalles|
|----|:----|
|Estado de la versión:|Disponibilidad general (GA)|
|Tipos de máquinas (escenarios híbridos):|:::image type="icon" source="./media/icons/yes-icon.png"::: Máquinas virtuales de Azure<br>:::image type="icon" source="./media/icons/yes-icon.png"::: Máquinas habilitadas para Azure Arc|
|Precios:|Requiere [Microsoft Defender para servidores](defender-for-servers-introduction.md)|
|Roles y permisos necesarios:|El rol [Propietario](../role-based-access-control/built-in-roles.md#owner) (nivel de grupo de recursos) puede implementar el detector.<br>El rol [Lector de seguridad](../role-based-access-control/built-in-roles.md#security-reader) puede ver los resultados.|
|Nubes:|:::image type="icon" source="./media/icons/yes-icon.png"::: Nubes comerciales<br>:::image type="icon" source="./media/icons/no-icon.png"::: Nacionales o soberanas (Azure Government y Azure China 21Vianet)|
|||

## <a name="overview-of-the-integrated-vulnerability-scanner"></a>Información general del detector de vulnerabilidades integrado

El analizador de vulnerabilidades incluido con Microsoft Defender for Cloud cuenta con tecnología de Qualys. El detector de Qualys es una de las herramientas líderes para identificar en tiempo real las vulnerabilidades. Solo está disponible con [Microsoft Defender para servidores](defender-for-servers-introduction.md). No necesita ninguna licencia ni cuenta de Qualys, ya que todo se administra sin problemas en Defender for Cloud.

### <a name="how-the-integrated-vulnerability-scanner-works"></a>Funcionamiento del detector de vulnerabilidades integrado

La extensión de detector de vulnerabilidades funciona de la siguiente manera:

1. **Implementación**: Microsoft Defender for Cloud supervisa las máquinas y proporciona recomendaciones para implementar la extensión de Qualys en las máquinas seleccionadas.

1. **Recopilación de información**: la extensión recopila artefactos y los envía para su análisis en el servicio en la nube de Qualys de la región definida.

1. **Análisis**: el servicio en la nube de Qualys realiza la evaluación de vulnerabilidades y envía los resultados a Defender for Cloud. 

    > [!IMPORTANT]
    > Para garantizar la privacidad, la confidencialidad y la seguridad de nuestros clientes, no compartimos la información de los clientes con Qualys. [Obtenga más información sobre los estándares de privacidad integrados en Azure](https://www.microsoft.com/trust-center/privacy).

1. **Informe**: los resultados están disponibles en Defender for Cloud.

[![Diagrama de flujo de proceso para el analizador de vulnerabilidades integrado de Microsoft Defender for Cloud.](media/built-in-vulnerability-assessment/va-vm-flow-diagram.png)](media/built-in-vulnerability-assessment/va-vm-flow-diagram.png#lightbox)


## <a name="deploy-the-integrated-scanner-to-your-azure-and-hybrid-machines"></a>Implementación del analizador integrado en las máquinas híbridas y de Azure

1. Abra **Defender for Cloud** en [Azure Portal](https://azure.microsoft.com/features/azure-portal/).

1. En el menú de Defender for Cloud, abra la página **Recomendaciones**.

1. Seleccione la recomendación **La solución de evaluación de vulnerabilidades debe estar habilitada en sus máquinas virtuales**.

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png" alt-text="Agrupaciones de las máquinas en la página de recomendaciones" lightbox="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png":::

    > [!TIP]
    > La máquina "Server16-test" anterior es una máquina habilitada para Azure Arc. Para implementar el detector de evaluación de vulnerabilidades en máquinas locales y en varias nubes, consulte [Conexión de máquinas que no son de Defender for Cloud](quickstart-onboard-machines.md).
    >
    > Defender for Cloud funciona sin problemas con Azure Arc. Cuando haya implementado Azure Arc, las máquinas aparecerán en Defender for Cloud y no se requiere ningún agente de Log Analytics.

    Las máquinas aparecerán en uno o varios de los siguientes grupos:

    * **Recursos correctos**: Defender for Cloud ha detectado una solución de evaluación de vulnerabilidades que se ejecuta en estas máquinas.
    * **Recursos incorrectos**: la extensión del detector de vulnerabilidades se puede implementar en estas máquinas. 
    * **Recursos no aplicables**: no se puede implementar la extensión del detector de vulnerabilidades en estas máquinas. Es posible que la máquina esté en esta pestaña porque es una imagen de un clúster de AKS, forma parte de un conjunto de escalado de máquinas virtuales o no ejecuta uno de los sistemas operativos compatibles con el examen de vulnerabilidades integrado:

        | **Proveedor** | **SISTEMA OPERATIVO**                         | **Versiones compatibles**                                             |
        |------------|--------------------------------|--------------------------------------------------------------------|
        | Microsoft  | Windows                        | All                                                                |
        | Red Hat    | Enterprise Linux               | 5.4+, 6, 7-7.9, 8-8.3                                              |
        | Red Hat    | CentOS                         | 5.4+, 6, 7, 7.1-7.8, 8-8.4                                         |
        | Red Hat    | Fedora                         | 22-33                                                              |
        | SUSE       | Linux Enterprise Server (SLES) | 11, 12, 15                                                         |
        | SUSE       | OpenSUSE                       | 12, 13, 15.0-15.2                                                  |
        | SUSE       | Leap                           | 42.1                                                               |
        | Oracle     | Enterprise Linux               | 5.11, 6, 7-7.9, 8-8.4                                              |
        | Debian     | Debian                         | 7.x-10.x                                                           |
        | Ubuntu     | Ubuntu                         | 12.04 LTS, 14.04 LTS, 15.x, 16.04 LTS, 18.04 LTS, 19.10, 20.04 LTS |

1. En la lista de máquinas incorrectas, seleccione las que recibirán una solución de evaluación de vulnerabilidades y seleccione **Corregir**.

    >[!IMPORTANT]
    > En función de la configuración, esta lista puede aparecer de manera diferente. 
    >
    > - Si no tiene un detector de vulnerabilidades de terceros configurado, no se le ofrecerá la oportunidad de implementarlo.
    > - Si las máquinas seleccionadas no están protegidas por Microsoft Defender para servidores, la opción Analizador de vulnerabilidades integrado de Defender for Cloud no estará disponible.

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-remediation-options-builtin.png" alt-text="Las opciones para el tipo de flujo de corrección que quiere elegir al responder a la recomendación de la página **La solución de evaluación de vulnerabilidades debe estar habilitada en sus máquinas virtuales**":::

1. Elija la opción recomendada, **Implementar el detector de vulnerabilidades integrado** y **Continuar**.

1. Se le pedirá una confirmación adicional. Seleccione **Corregir**.

    La extensión del escáner se instalará en todas las máquinas seleccionadas en unos minutos.
    
    El examen se iniciará automáticamente en cuanto se implemente correctamente la extensión. Los exámenes se ejecutarán cada 12 horas. Este intervalo no es configurable.

    >[!IMPORTANT]
    > Si se produce un error en el proceso de implementación en una o más máquinas, asegúrese de que las máquinas de destino puedan comunicarse con el servicio en la nube de Qualys; para ello, agregue las direcciones IP siguientes a sus listas de elementos admitidos (a través del puerto 443, que es el predeterminado para HTTPS):
    >
    >   - `https://qagpublic.qg3.apps.qualys.com`: centro de datos de Qualys en los EE. UU.
    >
    >   - `https://qagpublic.qg2.apps.qualys.eu`: centro de datos de Qualys en Europa.
    >
    > Si la máquina se encuentra en una región europea de Azure, sus artefactos se procesarán en el centro de datos europeo de Qualys. Los artefactos para máquinas virtuales ubicadas en cualquier otro lugar se envían al centro de datos de EE. UU.


## <a name="automate-at-scale-deployments"></a>Automatización de implementaciones a escala

> [!NOTE]
> Todas las herramientas que se describen en esta sección están disponibles en el [Repositorio de la comunidad de GitHub de Defender for Cloud](https://github.com/Azure/Azure-Security-Center/blob/master/README.md). En él puede encontrar scripts, automatizaciones y otros recursos útiles que puede usar a lo largo de la implementación de Defender for Cloud.
>
> Algunas de estas herramientas solo afectan a las nuevas máquinas conectadas después de habilitar la implementación a escala. Asimismo, otras también se implementan en los equipos existentes. Igualmente puede combinar varios enfoques.

Aquí tiene algunas de las formas para automatizar la implementación a escala del escáner integrado:

- **Azure Resource Manager**: este método está disponible en la **vista de recomendaciones lógicas** de Azure Portal. El script de corrección incluye la plantilla de ARM pertinente que puede usar para la automatización: :::image type="content" source="./media/deploy-vulnerability-assessment-vm/deploy-at-scale-remediation-logic.png" alt-text="El script de corrección incluye la plantilla de ARM pertinente que puede usar para la automatización." lightbox="./media/deploy-vulnerability-assessment-vm/deploy-at-scale-remediation-logic.png":::
- **Directiva DeployIfNotExists**: [es una directiva personalizada](https://github.com/Azure/Azure-Security-Center/tree/master/Remediation%20scripts/Enable%20the%20built-in%20vulnerability%20assessment%20solution%20on%20virtual%20machines%20(powered%20by%20Qualys)/Azure%20Policy) que se usa para garantizar que todos los equipos recién creados reciben el escáner. Seleccione **Implementar en Azure** y establezca los parámetros pertinentes. Puede asignar esta directiva en el nivel de grupos de recursos, suscripciones o grupos de administración.
- **Script de PowerShell**: use el script ```Update qualys-remediate-unhealthy-vms.ps1``` para implementar la extensión de todas las máquinas virtuales incorrectas. Para realizar instalaciones en nuevos recursos, automatice el script con [Azure Automation](../automation/automation-intro.md). El script busca todos los equipos incorrectos que haya detectado la recomendación y ejecuta una llamada a Azure Resource Manager.
- **Azure Logic Apps**: le permite compilar una aplicación lógica basada en la [aplicación de ejemplo](https://github.com/Azure/Azure-Security-Center/tree/master/Workflow%20automation/Install-VulnAssesmentAgent). Use las herramientas de [automatización del flujo de trabajo](workflow-automation.md) de Defender for Cloud para desencadenar la aplicación lógica y así implementar el escáner cada vez que deba generar la recomendación **Una solución de evaluación de vulnerabilidades debe habilitarse en las máquinas virtuales**.
- **API de REST**: para implementar la solución de evaluación de vulnerabilidades integrada mediante la API REST de Defender for Cloud, realice una solicitud PUT en la siguiente dirección URL y agregue el id. de recurso pertinente: ```https://management.azure.com/<resourceId>/providers/Microsoft.Security/serverVulnerabilityAssessments/default?api-Version=2015-06-01-preview```.



## <a name="trigger-an-on-demand-scan"></a>Desencadenamiento de un examen a petición

Puede desencadenar un examen a petición desde la propia máquina, mediante scripts u objetos de directiva de grupo (GPO) ejecutados de forma local o remota. Como alternativa, puede integrarlo en las herramientas de distribución de software al final de un trabajo de implementación de revisiones. 

Los siguientes comandos desencadenan un examen a petición:

- **Máquinas Windows**: ```REG ADD HKLM\SOFTWARE\Qualys\QualysAgent\ScanOnDemand\Vulnerability /v "ScanOnDemand" /t REG_DWORD /d "1" /f```
- **Máquinas Linux**: ```sudo /usr/local/qualys/cloud-agent/bin/cloudagentctl.sh action=demand type=vm```

## <a name="faq---integrated-vulnerability-scanner-powered-by-qualys"></a>P+F: Detector de vulnerabilidades integrado (con tecnología de Qualys)

### <a name="are-there-any-additional-charges-for-the-qualys-license"></a>¿Hay cargos adicionales por la licencia de Qualys?
No. El analizador integrado es gratuito para todos los usuarios de Microsoft Defender para servidores. La recomendación implementa el detector con la información de configuración y licencias. No se requieren licencias adicionales. 

### <a name="what-prerequisites-and-permissions-are-required-to-install-the-qualys-extension"></a>¿Qué requisitos previos y permisos son necesarios para instalar la extensión de Qualys?
Necesitará permisos de escritura para cualquier máquina en la que quiera implementar la extensión.

La extensión de evaluación de vulnerabilidades de Microsoft Defender for Cloud (con tecnología de Qualys), al igual que otras extensiones, se ejecuta sobre el agente de máquina virtual de Azure. Por lo tanto, se ejecuta como host local en Windows y raíz en Linux.

Durante la instalación, Defender for Cloud comprueba que la máquina puede comunicarse con los dos centros de datos de Qualys siguientes (a través del puerto 443, el valor predeterminado para HTTPS):

- `https://qagpublic.qg3.apps.qualys.com`: centro de datos de Qualys en los EE. UU.
- `https://qagpublic.qg2.apps.qualys.eu`: centro de datos de Qualys en Europa.

La extensión no acepta actualmente ningún detalle de configuración de proxy.

### <a name="can-i-remove-the-defender-for-cloud-qualys-extension"></a>¿Puedo quitar la extensión Defender for Cloud Qualys? 
Si quiere quitar la extensión de una máquina, puede hacerlo manualmente o con cualquiera de las herramientas de programación. 

Necesitará los siguientes detalles:

* En Linux, la extensión se denomina "LinuxAgent.AzureSecurityCenter" y el nombre del editor es "Qualys".
* En Windows, la extensión se denomina "WindowsAgent.AzureSecurityCenter" y el nombre del proveedor es "Qualys".

### <a name="how-does-the-extension-get-updated"></a>¿Cómo se actualiza la extensión?
Al igual que el propio agente de Microsoft Defender for Cloud y el resto de extensiones de Azure, las actualizaciones secundarias del detector Qualys se podrían realizar automáticamente en segundo plano. Todos los agentes y extensiones se prueban exhaustivamente antes de implementarse automáticamente.

### <a name="why-does-my-machine-show-as-not-applicable-in-the-recommendation"></a>¿Por qué muestra mi máquina el mensaje "no aplicable" en la recomendación?
La página de detalles de la recomendación agrupa las máquinas en las siguientes listas: **correcta**, **incorrecta** y **no aplicable**.

Si tiene máquinas en el grupo de recursos **no aplicables** significa que Defender for Cloud no puede implementar la extensión del detector de vulnerabilidades en esas máquinas.

Es posible que la máquina esté en esta pestaña porque:

- No está protegida por Azure Defender: como se explicó anteriormente, el examen de vulnerabilidades incluido en Microsoft Defender for Cloud solo está disponible para las máquinas protegidas por [Microsoft Defender para servidores](defender-for-servers-introduction.md).

- Se trata de una imagen en un clúster de AKS o parte de un conjunto de escalado de máquinas virtuales. Esta extensión no es compatible con las VM que son recursos de PaaS.

- No se ejecuta uno de los sistemas operativos compatibles:

    | **Proveedor** | **SISTEMA OPERATIVO**                         | **Versiones compatibles**                                             |
    |------------|--------------------------------|--------------------------------------------------------------------|
    | Microsoft  | Windows                        | All                                                                |
    | Red Hat    | Enterprise Linux               | 5.4+, 6, 7-7.9, 8-8.3                                              |
    | Red Hat    | CentOS                         | 5.4+, 6, 7, 7.1-7.8, 8-8.4                                         |
    | Red Hat    | Fedora                         | 22-33                                                              |
    | SUSE       | Linux Enterprise Server (SLES) | 11, 12, 15                                                         |
    | SUSE       | OpenSUSE                       | 12, 13, 15.0-15.2                                                  |
    | SUSE       | Leap                           | 42.1                                                               |
    | Oracle     | Enterprise Linux               | 5.11, 6, 7-7.9, 8-8.4                                              |
    | Debian     | Debian                         | 7.x-10.x                                                           |
    | Ubuntu     | Ubuntu                         | 12.04 LTS, 14.04 LTS, 15.x, 16.04 LTS, 18.04 LTS, 19.10, 20.04 LTS |
    |            |                                |                                                                    |

### <a name="what-is-scanned-by-the-built-in-vulnerability-scanner"></a>¿Qué examina el detector de vulnerabilidades integrado?
El analizador se ejecuta en la máquina para buscar vulnerabilidades de la propia máquina. Desde la máquina no puede examinar la red.

### <a name="does-the-scanner-integrate-with-my-existing-qualys-console"></a>¿Se integra el detector con mi consola de Qualys ya existente?
La extensión de Defender for Cloud es una herramienta independiente del detector Qualys existente. Las restricciones de licencia significan que solo se puede usar en Microsoft Defender for Cloud.

### <a name="how-quickly-will-the-scanner-identify-newly-disclosed-critical-vulnerabilities"></a>¿Con qué rapidez identificará el detector las vulnerabilidades críticas recién reveladas?
48 horas después de la divulgación de una vulnerabilidad crítica, Qualys incorpora la información en su proceso y puede identificar las máquinas afectadas.



## <a name="next-steps"></a>Pasos siguientes

> [!div class="nextstepaction"]
> [Corrección de los resultados de las soluciones de evaluación de vulnerabilidades](remediate-vulnerability-findings-vm.md)

Defender for Cloud también ofrece análisis de vulnerabilidades para:

- SQL Database: consulte [Exploración de los informes de evaluación de vulnerabilidades en el panel de evaluación de vulnerabilidades](defender-for-sql-on-machines-vulnerability-assessment.md#explore-vulnerability-assessment-reports).
- Imágenes de Azure Container Registry: consulte [Uso de Microsoft Defender para registros de contenedor a fin de examinar las imágenes en busca de vulnerabilidades](defender-for-container-registries-usage.md)
