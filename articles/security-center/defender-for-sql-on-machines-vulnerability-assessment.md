---
title: Uso del detector integrado de evaluación de vulnerabilidades de Microsoft Defender for Cloud para servidores de SQL Server
description: Obtenga más información sobre Microsoft Defender para servidores SQL Server en el detector integrado de evaluación de vulnerabilidades de las máquinas.
author: memildin
ms.author: memildin
manager: rkarlin
ms.service: security-center
ms.topic: how-to
ms.date: 09/14/2021
ms.openlocfilehash: 6886cb80133dd3b8df6b3c4dbb36123217f3289f
ms.sourcegitcommit: 702df701fff4ec6cc39134aa607d023c766adec3
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/03/2021
ms.locfileid: "131422470"
---
# <a name="scan-your-sql-servers-for-vulnerabilities"></a>Examen de servidores SQL en busca de vulnerabilidades

[!INCLUDE [Banner for top of topics](./includes/banner.md)]

**Microsoft Defender para servidores SQL Server en máquinas** amplía las protecciones de los servidores SQL Server nativos de Azure para admitir totalmente los entornos híbridos y proteger los servidores SQL Server (todas las versiones compatibles) hospedados en Azure, otros entornos en la nube e incluso en máquinas locales:

- [SQL Server en Virtual Machines](https://azure.microsoft.com/services/virtual-machines/sql-server/)
- Servidores SQL Server locales:
  - [SQL Server habilitado para Azure Arc (versión preliminar)](/sql/sql-server/azure-arc/overview)
  - [Servidores SQL Server que se ejecutan en máquinas Windows sin Azure Arc](../azure-monitor/agents/agent-windows.md)

El [examinador integrado de evaluación de vulnerabilidades](../azure-sql/database/sql-vulnerability-assessment.md) detecta posibles vulnerabilidades de la base de datos, las sigue y ayuda a corregirlas. Los resultados de los exámenes de evaluación proporcionan información general sobre el estado de seguridad de las máquinas SQL y detalles de las conclusiones de seguridad.

> [!NOTE]
> El examen es sencillo y seguro, solo tarda unos segundos en ejecutarse por cada base de datos y es completamente de lectura. No realiza ningún cambio en la base de datos. 

## <a name="explore-vulnerability-assessment-reports"></a>Exploración de los informes de evaluación de vulnerabilidades

El servicio de evaluación de vulnerabilidad examina las bases de datos cada 12 horas.

El panel de evaluación de vulnerabilidades proporciona una visión general de los resultados de la evaluación en todas las bases de datos, junto con un resumen de las bases de datos correctas y en mal estado, además de un resumen general de las comprobaciones con errores en función de la distribución del riesgo.

Puede ver los resultados de la evaluación de vulnerabilidades directamente desde Microsoft Defender for Cloud.

1. En la barra lateral de Microsoft Defender for Cloud, abra la página **Recomendaciones**.

1. Seleccione la recomendación **Es necesario corregir los resultados de la evaluación de vulnerabilidades de los servidores SQL Server en las máquinas (versión preliminar)** . Para obtener más información, consulte la [Página de referencia de recomendaciones de Microsoft Defender for Cloud](review-security-recommendations.md). 

    :::image type="content" source="./media/security-center-advanced-iaas-data/data-and-storage-sqldb-vulns-on-vm.png" alt-text="Es necesario corregir los resultados de la evaluación de vulnerabilidades de los servidores SQL Server en las máquinas (versión preliminar)":::

    Aparece la vista detallada de esta recomendación.

    :::image type="content" source="./media/defender-for-sql-on-machines-vulnerability-assessment/sql-vulnerability-findings.png" alt-text="Vista detallada de la recomendación":::

1. Para más detalles, explore en profundidad lo siguiente:

    - Para obtener información general de los recursos examinados (bases de datos) y la lista de comprobaciones de seguridad que se probaron, abra los **recursos afectados** y seleccione el servidor que le interesa.

    - Para obtener información general sobre las vulnerabilidades agrupadas por una base de datos SQL específica, seleccione la base de datos que le interesa.

    En cada vista, las comprobaciones de seguridad se ordenan por **gravedad**. Seleccione una comprobación de seguridad específica para ver un panel de detalles con una **descripción**, cómo **corregir** el problema y otra información relacionada como, por ejemplo, el **impacto** o el **punto de referencia**.

## <a name="set-a-baseline"></a>Establecimiento de una línea base 

Cuando revise los resultados de la evaluación, puede marcar los resultados como una línea de base aceptable en su entorno. La línea de base es fundamentalmente una personalización de cómo se notifican los resultados. Los resultados que coinciden con la línea de base se consideran como correctos en análisis posteriores. Una vez establecido el estado de seguridad de la base de referencia, el detector de la evaluación de vulnerabilidades solo informa de las desviaciones con respecto a esa base de referencia. De esta manera, podrá centrar su atención en los problemas relevantes.

:::image type="content" source="media/defender-for-sql-on-machines-vulnerability-assessment/analyze-report-for-details.png" alt-text="Cuando revise los resultados de la evaluación, puede marcar los resultados específicos como una línea de base aceptable en su entorno.":::

## <a name="export-results"></a>Exportar resultados

Use la característica de [Exportación continua](continuous-export.md) de Microsoft Defender for Cloud para exportar los resultados de la evaluación de vulnerabilidades a Azure Event Hub o a un área de trabajo de Log Analytics. 

## <a name="view-vulnerabilities-in-graphical-interactive-reports"></a>Visualización de vulnerabilidades en informes gráficos e interactivos

La Galería de libros de Azure Monitor integrada de Microsoft Defender for Cloud incluye un informe interactivo de todos los resultados de los examinadores de vulnerabilidades para máquinas, contenedores de registros de contenedor y servidores SQL Server.

Los resultados de cada uno de estos examinadores se informan en recomendaciones independientes:

- Es necesario corregir las vulnerabilidades de las máquinas virtuales
- Es necesario corregir las vulnerabilidades de las imágenes de Azure Container Registry (con tecnología de Qualys)
- Se deben corregir las conclusiones de la evaluación de vulnerabilidades de las bases de datos SQL
- Es necesario corregir los resultados de la evaluación de vulnerabilidades de los servidores SQL Server en las máquinas

El informe "Conclusiones de la evaluación de vulnerabilidades" recopila todos estos resultados y los organiza por gravedad, tipo de recurso y categoría. Puede encontrar el informe en la galería de libros, disponible en la barra lateral de Microsoft Defender for Cloud.

:::image type="content" source="media/defender-for-sql-on-machines-vulnerability-assessment/vulnerability-assessment-findings-report-sql.png" alt-text="Informe de conclusiones de evaluación de vulnerabilidades de Microsoft Defender for Cloud":::


## <a name="disable-specific-findings-preview"></a>Deshabilitación de resultados específicos (versión preliminar)

Si tiene la necesidad organizativa de omitir un resultado, en lugar de corregirlo, tiene la opción de deshabilitarlo. Los resultados deshabilitados no afectan a la puntuación de seguridad ni generan ruido no deseado.

Cuando un resultado coincide con los criterios que ha definido en las reglas de deshabilitación, no aparecerá en la lista de resultados. Entre los escenarios típicos se incluyen:

- Deshabilitar resultados con gravedad inferior a media
- Deshabilitar resultados que no se pueden revisar
- Deshabilitar resultados de los puntos de referencia que no son de interés para un ámbito definido

> [!IMPORTANT]
> Para deshabilitar conclusiones específicas, necesita permisos para editar directivas en Azure Policy. Obtenga más información en [Permisos de Azure RBAC en Azure Policy](../governance/policy/overview.md#azure-rbac-permissions-in-azure-policy).

Para crear una regla:

1. En la página de detalles de recomendaciones de **Es necesario corregir los resultados de la evaluación de vulnerabilidades de los servidores SQL Server en las máquinas**, seleccione **Deshabilitar regla**.

1. Seleccione el ámbito pertinente.

1. Defina los criterios. Puede utilizar cualquiera de los criterios siguientes: 
    - Identificador del resultado 
    - severity 
    - Pruebas comparativas 

    :::image type="content" source="./media/defender-for-sql-on-machines-vulnerability-assessment/disable-rule-vulnerability-findings-sql.png" alt-text="Creación de una regla de deshabilitación para los resultados de VA en servidores SQL Server en máquinas virtuales.":::

1. Seleccione **Aplicar regla**. Los cambios pueden tardar hasta 24 horas en surtir efecto.

1. Para ver, invalidar o eliminar una regla: 

    1. Seleccione **Deshabilitar regla**.

    1. En la lista de ámbitos, las suscripciones con reglas activas se muestran como **Regla aplicada**.

        :::image type="content" source="./media/remediate-vulnerability-findings-vm/modify-rule.png" alt-text="Modificación o eliminación de una regla existente.":::

    1. Para ver o eliminar la regla, seleccione el menú de puntos suspensivos ("...").

## <a name="manage-vulnerability-assessments-programmatically"></a>Administración de las evaluaciones de vulnerabilidades mediante programación

### <a name="using-azure-powershell"></a>Uso de Azure PowerShell

Puede usar los cmdlets de Azure PowerShell para administrar mediante programación sus evaluaciones de vulnerabilidad. Los cmdlets compatibles son:

| Nombre del cmdlet como vínculo | Descripción |
| :-------------------- | :---------- |
| [Add-AzSecuritySqlVulnerabilityAssessmentBaseline](/powershell/module/az.security/add-azsecuritysqlvulnerabilityassessmentbaseline) | Agrega la línea de base de la evaluación de vulnerabilidades de SQL. |
| [Get-AzSecuritySqlVulnerabilityAssessmentBaseline](/powershell/module/az.security/get-azsecuritysqlvulnerabilityassessmentbaseline) | Obtiene la línea de base de la evaluación de vulnerabilidades de SQL. |
| [Get-AzSecuritySqlVulnerabilityAssessmentScanResult](/powershell/module/az.security/get-azsecuritysqlvulnerabilityassessmentscanresult) | Obtiene los resultados del examen de la evaluación de vulnerabilidades de SQL. |
| [Get-AzSecuritySqlVulnerabilityAssessmentScanRecord](/powershell/module/az.security/get-azsecuritysqlvulnerabilityassessmentscanrecord) | Obtiene los registros del examen de la evaluación de vulnerabilidades de SQL. |
| [Remove-AzSecuritySqlVulnerabilityAssessmentBaseline](/powershell/module/az.security/remove-azsecuritysqlvulnerabilityassessmentbaseline) | Quita la base de referencia de la evaluación de vulnerabilidades de SQL. |
| [Set-AzSecuritySqlVulnerabilityAssessmentBaseline](/powershell/module/az.security/set-azsecuritysqlvulnerabilityassessmentbaseline) | Establece la nueva línea de base de la evaluación de vulnerabilidades de SQL en una base de datos específica y descarta la base de base anterior si existe alguna. |
| &nbsp; | &nbsp; |

## <a name="data-residency"></a>Residencia de datos

La evaluación de vulnerabilidades de SQL consulta el servidor de SQL Server mediante consultas disponibles públicamente en recomendaciones de Microsoft Defender for Cloud para la evaluación de vulnerabilidades de SQL y almacena los resultados de la consulta. Los datos de evaluación de vulnerabilidades de SQL se almacenan en la ubicación del área de trabajo de Log Analytics a la que está conectada la máquina. Por ejemplo, si el usuario conecta una máquina virtual de SQL a un área de trabajo de Log Analytics en el oeste de Europa, los resultados se almacenarán en el oeste de Europa. Estos datos solo se recopilarán si la evaluación de vulnerabilidades de SQL está habilitada en el área de trabajo de Log Analytics.

También se recopila información de metadatos sobre la máquina conectada. Concretamente:

-   Nombre, tipo y versión del sistema operativo
-   Nombre de dominio completo (FQDN) del equipo
-   Versión del agente Connected Machine
-   UUID (IDENTIFICADOR DE BIOS)
-   Nombre del servidor de SQL y nombres de base de datos subyacentes

La evaluación de vulnerabilidades de SQL permite especificar la región donde se almacenarán los datos eligiendo la ubicación del área de trabajo de Log Analytics. Microsoft puede replicar en otras regiones para obtener resistencia de datos, pero no replica datos fuera de la geografía.

## <a name="next-steps"></a>Pasos siguientes

Obtenga más información sobre las protecciones de Microsoft Defender for Cloud para los recursos de SQL en [Introducción a Microsoft Defender para SQL](defender-for-sql-introduction.md).
